---
#
#
#
- name: Create config space for cloudflare beacon
  file:
    dest: /etc/cloudflare-beacon
    owner: root
    group: root
    mode: 0755
    state: directory

- name: Create nginx config file
  template:
    dest: /etc/cloudflare-beacon/default.conf
    src: default.conf.j2
    owner: root
    group: root
    mode: 0644
  notify: Restart Cloudflare Beacon Systemd Unit

- name: Place or Create x509 Certificate
  import_tasks:
    file: x509_cert.yaml
              
- name: Create beacon systemd container file
  template:
    dest: /etc/containers/systemd/cloudflare-beacon.container
    src: cloudflare-beacon.container.j2
    owner: root
    group: root
    mode: 0644
  notify: Reload Cloudflare Beacon Systemd Unit
