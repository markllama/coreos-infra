---
variant: fcos
version: 1.6.0

passwd:
  users:
    - name: core
      password_hash: "$y$j9T$SaOLMVafuREVdfdBN5A9H0$b9r69cSizszBOeCfHhQ9ypPw5aI8bb0ALfhCqLvOjE1"
      ssh_authorized_keys:
        - "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDpHnYpDgfEaKLe/pvfFMpgoKM3w8mXqUtRPM2GEn0EkqbTprjLPwYBIi5hMNhbfeQU05JUECYM/5OzIsjrNfKEA7vv3+F9Uju8BDnNMXaV00IzYktR8gmUnDujcwWiB+X09XVPikF6kWjrKSZOFXQG/aclSO/fGD8gayxOm5F93Fo+BTjMY2IOxQOFWcpVmmeHMsqcgyFoLHUVr4EU3YjdRwfnxJPyoKf+RqiRRQrXpGamBuJzf0atBr3vHrXcz8adTQW+bgA+6mvSmiryqb97eFh/UO4cc1sz5SCq9bYBXWAvVQ8qrMROiB9yUwvsAvrf6gYG6UlggjpkXA9VMhmp markllama@gmail.com"

    - name: mark
      password_hash: "$y$j9T$GeXXw/i8SrjyB3NCAtgk8.$QNfOtkiLiyAeiaf7PreuYdRxBDhtjofMGOtPFSkn6JB"
      ssh_authorized_keys:
        - "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDpHnYpDgfEaKLe/pvfFMpgoKM3w8mXqUtRPM2GEn0EkqbTprjLPwYBIi5hMNhbfeQU05JUECYM/5OzIsjrNfKEA7vv3+F9Uju8BDnNMXaV00IzYktR8gmUnDujcwWiB+X09XVPikF6kWjrKSZOFXQG/aclSO/fGD8gayxOm5F93Fo+BTjMY2IOxQOFWcpVmmeHMsqcgyFoLHUVr4EU3YjdRwfnxJPyoKf+RqiRRQrXpGamBuJzf0atBr3vHrXcz8adTQW+bgA+6mvSmiryqb97eFh/UO4cc1sz5SCq9bYBXWAvVQ8qrMROiB9yUwvsAvrf6gYG6UlggjpkXA9VMhmp markllama@gmail.com"
      groups:
        - sudo
        - wheel
storage:
  files:
    - path: /etc/hostname
      contents:
        inline: |
          pi4-1.lamourine.org

# TODO - add file and service to install ansible
    - path: /usr/local/bin/install-overlay-packages
      user:
        name: root
      group:
        name: root
      mode: 0755
      contents:
        inline: |
          #!/bin/bash

          if [ -x /usr/bin/ansible ] ; then
            rm /usr/local/bin/install-overlay-packages
            systemctl disable install-overlay-packages
            rm /etc/systemd/system/install-overlay-packages.service
          else
            rpm-ostree install --assumeyes ansible
            systemctl reboot
          fi

systemd:
  units:
    - name: install-overlay-packages.service
      enabled: true
      contents: |
        [Unit]
        Description=Install Overlay Packages
        After=systemd-resolved.service
        Before=zincati.service

        [Service]
        Type=oneshot
        ExecStart=/usr/local/bin/install-overlay-packages

        [Install]
        WantedBy=multi-user.target
